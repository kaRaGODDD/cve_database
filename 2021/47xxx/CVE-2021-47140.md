
# [CVE-2021-47140](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-47140)

## Description

- `In the Linux kernel, the following vulnerability has been resolved:iommu/amd: Clear DMA ops when switching domainSince commit 08a27c1c3ecf ("iommu: Add support to change default domainof an iommu group") a user can switch a device between IOMMU and directDMA through sysfs. This doesn't work for AMD IOMMU at the moment becausedev->dma_ops is not cleared when switching from a DMA to an identityIOMMU domain. The DMA layer thus attempts to use the dma-iommu ops on anidentity domain, causing an oops:  # echo 0000:00:05.0 > /sys/sys/bus/pci/drivers/e1000e/unbind  # echo identity > /sys/bus/pci/devices/0000:00:05.0/iommu_group/type  # echo 0000:00:05.0 > /sys/sys/bus/pci/drivers/e1000e/bind   ...  BUG: kernel NULL pointer dereference, address: 0000000000000028   ...   Call Trace:    iommu_dma_alloc    e1000e_setup_tx_resources    e1000e_openSince iommu_change_dev_def_domain() calls probe_finalize() again, clearthe dma_ops there like Vt-d does.`

## Cvss Data

- **Access Vector**:
  - 
- **Base Score**:
  - 

## Scores

- **Exploitability Score**:
  - 
- **Impact Score**:
  - 
- **Base Severity**:
  - 

## Other Information

- **Publish Date**:
  - 2024-03-25 09:15:08
- **Vulnerability Status**:
  - Awaiting Analysis

## References

- **416baaa9-dc9f-4396-8d5f-8c081fb06d67**: https://git.kernel.org/stable/c/d6177a6556f853785867e2ec6d5b7f4906f0d809
- **416baaa9-dc9f-4396-8d5f-8c081fb06d67**: https://git.kernel.org/stable/c/f3f2cf46291a693eab21adb94171b0128c2a9ec1

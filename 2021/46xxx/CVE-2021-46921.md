
# [CVE-2021-46921](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-46921)

## Description

- `In the Linux kernel, the following vulnerability has been resolved:locking/qrwlock: Fix ordering in queued_write_lock_slowpath()While this code is executed with the wait_lock held, a reader canacquire the lock without holding wait_lock.  The writer side loopschecking the value with the atomic_cond_read_acquire(), but only trulyacquires the lock when the compare-and-exchange is completedsuccessfully which isnâ€™t ordered. This exposes the window between theacquire and the cmpxchg to an A-B-A problem which allows readsfollowing the lock acquisition to observe values speculatively beforethe write lock is truly acquired.We've seen a problem in epoll where the reader does a xchg whileholding the read lock, but the writer can see a value change out fromunder it.  Writer                                | Reader  --------------------------------------------------------------------------------  ep_scan_ready_list()                  |  |- write_lock_irq()                   |      |- queued_write_lock_slowpath()   |	|- atomic_cond_read_acquire()   |				        | read_lock_irqsave(&ep->lock, flags);     --> (observes value before unlock) |  chain_epi_lockless()     |                                  |    epi->next = xchg(&ep->ovflist, epi);     |                                  | read_unlock_irqrestore(&ep->lock, flags);     |                                  |     |     atomic_cmpxchg_relaxed()     |     |-- READ_ONCE(ep->ovflist);        |A core can order the read of the ovflist ahead of theatomic_cmpxchg_relaxed(). Switching the cmpxchg to use acquiresemantics addresses this issue at which point the atomic_cond_read canbe switched to use relaxed semantics.[peterz: use try_cmpxchg()]`

## Cvss Data

- **Access Vector**:
  - 
- **Base Score**:
  - 

## Scores

- **Exploitability Score**:
  - 
- **Impact Score**:
  - 
- **Base Severity**:
  - 

## Other Information

- **Publish Date**:
  - 2024-02-27 10:15:06
- **Vulnerability Status**:
  - Awaiting Analysis

## References

- **416baaa9-dc9f-4396-8d5f-8c081fb06d67**: https://git.kernel.org/stable/c/5902f9453a313be8fe78cbd7e7ca9dba9319fc6e
- **416baaa9-dc9f-4396-8d5f-8c081fb06d67**: https://git.kernel.org/stable/c/82808cc026811fbc3ecf0c0b267a12a339eead56
- **416baaa9-dc9f-4396-8d5f-8c081fb06d67**: https://git.kernel.org/stable/c/82fa9ced35d88581cffa4a1c856fc41fca96d80a
- **416baaa9-dc9f-4396-8d5f-8c081fb06d67**: https://git.kernel.org/stable/c/84a24bf8c52e66b7ac89ada5e3cfbe72d65c1896
- **416baaa9-dc9f-4396-8d5f-8c081fb06d67**: https://git.kernel.org/stable/c/d558fcdb17139728347bccc60a16af3e639649d2
